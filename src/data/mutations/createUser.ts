import { User } from "../connectors";
import { MailService, Email } from "../../smtp";

export const createUser = (root, { email, password }) => {
  console.log("testing!!");
  return User.findOne({ email })
    .then((existingUser) => {
      if (existingUser) {
        console.log("CreateUser: Email in use");
        throw Error("Email in use");
      }
      let ms = new MailService();
      ms.sendMail(new Email(
        email,
        "email testing!",
        `Your autogenerated password is:${password}`,
        `<b>Your autogenerated password is:${password}<b>`
      ));

      return User.create({ email, password })
        .catch((err) => {
          console.log("CreateUser: Error creating user", err);
        });
    });
};
